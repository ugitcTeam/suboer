<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>工程变更申请单</title>
	<link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/app.js"></script>
    <style type="text/css">
		.right-block{margin-right: 0px;margin-left: auto; display: inline-block;}
	</style>
</head>
<body>
	<div class="sd-rc">
		<h2 class="title">工程变更申请单</h2>
		<div class="content">
			<div class="header box">
				<div>ECR:<input type="text" name="ecr"></div>
            	<div class="right-block">编号：SPE R02-047</div>
			</div>
		</div>
		<div>
			<table class="rc-table">
				<tr class="role1">
					<td class="attr">提出部门</td>
					<td class="odd">
						<select name="tcbm" class="tcbm">
						</select>
					</td>
					<td class="attr">提出人</td>
					<td><span class="tcr"></span></td>
				</tr>
				<tr class="role1">
					<td class="attr">接收部门</td>
					<td class="odd">
						<label>
							<input type="radio" name="jsbm" value="" />
							<select class="jsbm" name="jsbm" id=""></select>
						</label>
						<label> 
							<input type="radio" name="jsbm" value="工艺部" />工艺部
						</label>
					</td>
					<td class="attr">接收人</td>
					<td>
						<input class="jsr" type="text" name="jsr" />
					</td>
				</tr>
				<tr class="role1">
					<td class="attr">产品型号</td>
					<td class="odd"><input class="cpxh" type="text" name="cpxh" /></td>
					<td class="attr">销售渠道</td>
					<td>
						<label><input type="radio" name="xsqd" value="SEB" />SEB</label>
						<label><input type="radio" name="xsqd" value="外贸" />外贸</label>
						<label><input type="radio" name="xsqd" value="内销" />内销</label>
					</td>
				</tr>
				<tr class="role1">
					<td class="attr">变更申请描述</td>
					<td colspan="3">
						<div class="textarea bgsqms">
							<textarea class="w560" name="bgsqms" maxlength="300" len=15 disabled="disabled"></textarea>
							<img class="bgsqmstp" alt="" style="width: 200px;height: 200px; vertical-align: middle;">
							<input type="file" name="bgsqmstp" class="upImg">
						</div>
					</td>
				</tr>
				<tr class="role2">
					<td class="attr">变更评估</td>
					<td colspan="3">
						<div class="textarea bgpg">
							<textarea class="w560" name="bgpg" maxlength="20"></textarea>
							<img class="bgpgtp" src="" alt="" style="width: 200px;height: 200px; vertical-align: middle;">
							<input type="file" name="bgpgtp" class="upImg">
						</div>
					</td>
				</tr>
				<tr class="role2">
					<td colspan="4">
						修改模评估：
						是否改模
						<label><input type="radio" name="sfxgm" value="否" />否</label>	
						<label><input type="radio" name="sfxgm" value="是" />是</label>	
						<span class="ns">如选择否，以下内容不填写</span>
					</td>
				</tr>
				<tr class="role2 isMu">
					<td class="subT" colspan="4">
						<div class="box clear">
							<div class="w5 left">
								<span>是否有备模</span>
								<label> <input type="radio" name="bm" value="否" />否</label>
								<label> <input type="radio" name="bm" value="是" />是</label>
								<label>备模数量：<input class="number" type="number" name="bmsl" /></label>
							</div>
							<div class="w5 right">
								<span>是否共模</span>
								<label><input type="radio" name="gom" value="否" />否</label>
								<label><input type="radio" name="gom" value="是" />是</label>
							</div>
						</div>
						<div class="box clear">
							<div class="w5 left">
								<span>是否共用件</span>
								<label><input type="radio" name="gyj" value="否" />否</label>
								<label><input type="radio" name="gyj" value="是" />是</label>
							</div>
							<div class="w5 right">
								<label>共用件型号/名称：<input type="text" name="gyjxh" /></label>
							</div>
						</div>
						
					</td>
				</tr>
				<tr class="role2 isMu">
					<td class="attr">
						模具类别
					</td>
					<td>
						<label><input type="radio" name="mjlb" value="塑胶" />塑胶</label>
						<label><input type="radio" name="mjlb" value="五金" />五金</label>
					</td>
					<td class="attr">零件名称</td>
					<td><input type="text" name="ljmc" /></td>
				</tr>
				<tr class="role2 isMu">
					<td class="attr">零件图号</td>
					<td><input type="text" name="ljth"/></td>
					<td class="attr">模具编号</td>
					<td><input type="text" name="mjbh" /></td>
				</tr>
				<tr class="role2 isMu">
					<td class="attr">内部订单号</td>
					<td><input type="text" name="nbddh" /></td>
					<td class="attr">成本中心</td>
					<td><input type="text" name="cbzx" /></td>
				</tr>
				<tr class="role2 isMu">
					<td class="attr">改模前</td>
					<td colspan="3">
						<div class="textarea gmq">
							<textarea class="w560" name="gmq"></textarea>
							<img src="" alt="" style="width: 200px;height: 200px; vertical-align: middle;">
							<input type="file" name="" class="upImg">
						</div>
					</td>
				</tr>
				<tr class="role2 isMu">
					<td class="attr">改模后</td>
					<td colspan="3">
						<div class="textarea qmh">
							<textarea class="w560" name="gmh"></textarea>
							<img src="" alt="" style="width: 200px;height: 200px; vertical-align: middle;">
							<input type="file" name="" class="upImg">
						</div>
					</td>
				</tr>
				<tr class="role3 isMu">
					<td class="attr">物控意见</td>
					<td colspan="2">
						<div class="textarea wkyj">
						</div>
					</td>
					<td>
						<span class="qm">签名：</span><span class="wkqm"></span><span class="wkqmrq"></span>
					</td>
				</tr>
				<tr class="role4 isMu">
					<td class="attr">注塑工艺意见</td>
					<td colspan="2">
						<div class="textarea zsgyyj">
						</div>
					</td>
					<td>
						<span class="qm">签名：</span><span class="gyqm"></span><span class="gyqmrq"></span>
					</td>
				</tr>
				<tr class="role5 isMu">
					<td class="attr">模具工艺意见</td>
					<td colspan="2">
						<div class="textarea mjgyyj">
						</div>
					</td>
					<td>
						<span class="qm">签名：</span><span class="mjqm"></span><span class="mjqmrq"></span>
					</td>
				</tr>
				<tr class="role6">
					<td class="attr">
						接收部门意见
					</td>
					<td colspan="2">
						<div class="jsbmyj"></div>
					</td>
					<td>
						<span class="qm">签名：</span><span class="jsbmqm"></span><span class="jsbmqmrq"></span>
					</td>
				</tr>
			</table>	
		</div>
		
	</div>
</body>
<script type="text/javascript">
	$(function(){
		$(".sd-rc").show();
		var flows=["新建","变更评估","物控评估","注塑工艺","模具工艺","ECR批准"];
		var role=0;
		var tcbmData=[
		"电压力锅研发部","电炸锅研发部","SEB料理机研发部","破壁料理机研发部","电磁炉研发部","电水壶研发部","咖啡机多士炉研发部","工艺部","质量部","采购部","制造部"
		];
		var jsbmData=["电压力锅研发部","电炸锅研发部","SEB料理机研发部","破壁料理机研发部","电磁炉研发部","电水壶研发部","咖啡机多士炉研发部"];
		var qpplyList=[
				{type:"select",name:"tcbm",title:"提出部门"}
				,{type:"radio",name:"jsbm",title:"接收部门"}
				,{type:"text",name:"jsr",title:"接收人"}
				,{type:"text",name:"cpxh",title:"产品型号"} 
				,{type:"radio",name:"xsqd",title:"销售渠道"}
				,{type:"textarea",name:"bgsqms",title:"变更申请描述"}
				,{type:"file",name:"bgsqmstp",title:"变更申请描述图片"}
				// ,{type:"textarea",name:"bgpg",title:"变更评估"}
				// ,{type:"file",name:"bgpgtp",title:"变更评估图片"}
				// ,{type:"radio",name:"sfxgm",title:"是否改模"}
			];
		var EceList=[
			{type:"textarea",name:"bgpg",title:"变更评估"}
			,{type:"file",name:"bgpgtp",title:"变更评估图片"}
			,{type:"radio",name:"sfxgm",title:"是否改模"}
		]
		var $tcbmSelect=$(".tcbm");
		var $jsbmSelect=$(".jsbm");
		var constant_obj={};//常量，接收数据和发送数据
		window.app=window.app;
		//提出部门下拉框数据填充
		$(tcbmData).each(function(index,element){
			$tcbmSelect.append("<option value='"+element+"'>"+element+"</option>");
		});
		// 接收部门下拉框数据填充
		$(jsbmData).each(function(index,element){
			$jsbmSelect.append("<option value='"+element+"'>"+element+"</option>");
		});
		// $jsbmSelect.change(function(){
		// 	$(this).prev().val(this.value);
		// });
		$("input:radio").click(function(){
			// 如果相邻节点是select下拉框，则去下拉框值
			if($(this).next()[0]&&$(this).next()[0].nodeName=="SELECT"){
				this.value=$(this).next()[0].value;
			}
			// 当前按钮如果是改模，进行特殊处理
			if(this.name=="sfxgm"){
				this.value=="否"?$(".isMu").hide():editMu();
			}
		});
		function editMu(){
			$(".isMu").show()
			$(".isMu").find("input").prop("disabled","");
			$(".isMu").find("textarea").prop("disabled","");
			$(".isMu").find("input[type='file']").show();
		}
		// 下拉框是改变时，有特殊处理
		$("select").change(function(){
			if($(this).prev()[0]&&$(this).prev()[0].nodeName=="INPUT"){
				$(this).prev()[0].value=this.value;
			}
		});
		// 下拉框点击时，有特殊处理
		$("select").click(function(){
			if($(this).prev()[0]&&$(this).prev()[0].nodeName=="INPUT"){
				$($(this).prev()).click();
			}
		});
		$("div[contenteditable]").keyup(function(){
			var text=event.data;
			if(text!==this.innerText){
				event.data=this.innerText;
			}
		});
		// 显示当前权限编辑区
		
		//创建申请单获取参数方法
		/**
		 * [getRole2 description] 创建变更申请单
		 * @return {[type]} [description] 返回创建数据对象
		 */
		function getApplyData(){
			var obj=app.getObj(qpplyList);
			obj.seNo="SPE R02-047";		
			return obj;
		}
		function getEce(){
			var obj=app.getObj(EceList);
			if(obj.sfgm=="是"){
				$.extend(obj,isGm());
			}
			return obj;
		}
		//如果是改模，调用此方法获取改模数据
		function isGm(){
			var list=[
				{type:"radio",name:"bm",title:"是否有备模"}
				,{type:"radio",name:"gom",title:"是否共模"}
				,{type:"radio",name:"gyj",title:"是否共用件"}
				,{type:"text",name:"gyjxh",title:"共用件型号/名称"}
				,{type:"radio",name:"mjlb",title:"模具类别"}
				,{type:"text",name:"ljmc",title:"零件名称"}
				,{type:"text",name:"ljth",title:"零件图号"}
				,{type:"text",name:"mjbh",title:"模具编号"}
				,{type:"text",name:"nbddh",title:"内部订单号"}
				,{type:"text",name:"cbzx",title:"成本中心"}
				,{type:"textarea",name:"gmq",title:"改模前描述"}
				,{type:"textarea",name:"gmh",title:"改模后描述"}
			];
			return app.getObj(list);
		}
		var signArr=['wk','gy','mj','js'];
		var signList={
				"wk":[
					{type:"textarea",name:"wkyj",title:"物控意见"}
					,{type:"text",name:"wkqm",title:"物控签名"}
					,{type:"NowDate",name:"wkqmrq",title:"物控签名日期"}
				]
				,"gy":[
					{type:"textarea",name:"zsgyyj",title:"注塑工艺意见"}
					,{type:"text",name:"gyqm",title:"工艺签名"}
					,{type:"NowDate",name:"gyqmrq",title:"工艺签名日期"}
				],
				"mj":[
					{type:"textarea",name:"mjgyyj",title:"模具工艺意见"}
					,{type:"text",name:"mjqm",title:"模具签名"}
					,{type:"NowDate",name:"mjqmrq",title:"模具签名日期"}
				],
				"js":[
					{type:"textarea",name:"jsbmyj",title:"接收部门意见"}
					,{type:"text",name:"jsbmqm",title:"接收部门签名"}
					,{type:"NowDate",name:"jsbmqmrq",title:"接收部门签名日期"}
				]
			};
		/**
		 * [getSign description] 根据角色获取意见和签名
		 * @param  {[type]} key [description] 当前角色标识
		 * @return {[type]}     [description] 返回当前角色输入的数据对象
		 */
		function getSign(key){
			return app.getObj(signList[key]);	
		}
		//获取表单数据
		function getData(){
			return switchRole(role);
		}
		window.getData=getData;
		
		function switchRole(role){
			var obj=null;
			switch (role) {
				//创建申请单
				case 1:
					obj = getApplyData();
					break;
				case 2:
					obj = getEce();
				case 3:
					obj=getSign(signArr[0]);
					break;
				case 4:
					boj=getSign(signArr[1]);
					break;
				case 5:
					boj=getSign(signArr[2]);
					break;
				case 6:
					boj=getSign(signArr[3]);
					break;
				default:
					// 获取申请单数据
					obj=getApplyData();
					break;
			}
			$.extend(obj,constant_obj);
			//解决IE8 内置JSON.stringify,中文变unicode的问题
			eval("var str='"+JSON.stringify(obj)+"';");
			return str;
		}
		function setData(data){
			role=flows.indexof(data.flow)+1;
			app.showRole(role);
			$.extend(constant_obj,{jsbmsftybgsq:data.jsbmsftybgsq,itemId:data.itemId,id:data.id});
			switch (role){
				case 6:
					setSign(data,signArr[3],true);
				case 5:
					setSign(data,signArr[2]);
				case 4:
					setSign(data,signArr[1]);
				case 3:
					setSign(data,signArr[0]);
				case 2:
					setRole1(data);
					break;
				default:
					$(".tcr").setSpan(data.tcr);

			}
		}
		// 申请单数据填充
		function setRole1(data){
			$(".tcbm").val(data.tcbm).attr("disabled","disabled");
			$(".tcr").text(data.tcr);
			$.setRadio("jsbm",data.jsbm);
			$(".jsr").val(data.tcr).disabled();
			$(".cpxh").setText(data.cpxh);
			$.setRadio("xsqd",data.xsqd);
			$(".bgsqms").setPre(data.bgsqms);
			$(".bgsqmstp").setImg(data.bgsqmstp);
			// $(".bgpg").setPre(data.bgpg);
			// $.setRadio("sfxgm",data.sfxgm);
			// if(data.sfxgm=="是"){
			// 	setIsmu(data.mu);
			// }
		}
		 function setIsmu(data){
		 	$.setRadio("bm",data.bm);
		 	$.setText("bmsl",data.bmsl);
		 	$.setRadio("gom",data.gom);
		 	$.setRadio("gyj",data.gyj);
		 	$.setText("gyjxh",data.gyjxh);
		 	$.setRadio("mjlb",data.mjlb);
		 	$.setText("ljmc",data.ljmc);
		 	$.setText("ljth",data.ljth);
		 	$.setText("mjbh",data.mjbh);
		 	$.setText("nbddh",data.nbddh);
		 	$.setText("cbzx",data.cbzx);
		 	$(".gmq").setPre("value");
		 	$(".qmh").setPre("value");
		 }
		 // 签字数据填充
		 function setSign(data,key,flog){
		 	if(data.sfxgm=="否" || flog){
			 	$(signList[key]).each(function(){
			 		// $.objSetValue[this.type](this.name,data[this.name]);
			 		$("."+this.name).text(data[this.name]);
			 	});
		 	}
		 }
		window.setData=setData;
		window.setRole1=setRole1;
	});
</script>
</html>